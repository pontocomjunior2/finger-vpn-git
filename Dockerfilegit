# Dockerfile otimizado para deploy GitHub via EasyPanel
# Usar uma imagem base Python 3.11 slim baseada no Debian Bookworm
FROM python:3.11-slim-bookworm

# Instalar dependências do sistema: ffmpeg (essencial) e ca-certificates (para HTTPS)
# Limpar cache do apt para reduzir o tamanho da imagem
RUN apt-get update && \
    apt-get install -y --no-install-recommends ffmpeg ca-certificates && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Definir o diretório de trabalho dentro do container
WORKDIR /app

# Copiar apenas o arquivo de dependências primeiro para aproveitar o cache do Docker
COPY app/requirements.txt .

# Instalar as dependências Python
RUN python -m pip install --upgrade pip && \
    pip install --no-cache-dir -r requirements.txt

# Copiar o código da aplicação
COPY app/ .

# Criar diretório de segmentos (persistente via volume no compose)
RUN mkdir -p /app/segments && chmod -R 777 /app/segments

# Saída sem buffer para logs em tempo real
ENV PYTHONUNBUFFERED=1

# Comando de inicialização da aplicação
CMD ["python", "fingerv7.py"]